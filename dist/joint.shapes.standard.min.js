/*! Rappid v2.4.0 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2015 client IO

 2019-03-27 


This Source Code Form is subject to the terms of the Rappid Trial License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/


!function(a,b,c){function d(a){throw new Error("shapes.standard.Record: "+a)}var e=a.dia.Element,f=a.shapes.standard,g=e.define("standard.Record",{size:{width:100},padding:0,items:[],itemHeight:20,itemOffset:20,itemMinLabelWidth:10,itemButtonSize:10,itemIcon:{width:16,height:16,padding:2},itemOverflow:!1,attrs:{bodiesGroups:{fill:"transparent",stroke:"none"},labelsGroups:{fill:"#333333"},buttonsGroups:{fill:"transparent",stroke:"#333333",strokeWidth:1},forksGroups:{stroke:"#333333"},groups:{groupPosition:!0},itemBodies:{groupWidth:!0,itemHighlight:{fill:"#eeeeee"}},itemLabels:{fontSize:16,textVerticalAnchor:"middle",pointerEvents:"bounding-box",itemText:{textWrap:!0,ellipsis:!0},itemHighlight:{fill:"red"}}}},{markup:[],metrics:null,markupAttributes:["items","itemHeight","itemOffset","itemIcon","itemMinLabelWidth","itemButtonSize","itemOverflow","padding"],initialize:function(){a.dia.Element.prototype.initialize.apply(this,arguments),this.on("change",this.onChange,this),this.buildMarkup()},anyHasChanged:function(a){return!!Array.isArray(a)&&a.some(function(a){return this.hasChanged(a)},this)},onChange:function(a,b){b.record!==this.id&&this.hasChanged("markup")&&d("Markup can not be modified."),this.anyHasChanged(this.markupAttributes)&&this.buildMarkup(b)},buildMarkup:function(a){var c=this.metrics={},e=c.items={},f=this.attributes,g=f.itemHeight,h=f.itemOffset,i=!!f.itemOverflow,j=f.items;Array.isArray(j)||(j=[]);var k=j.length,l=0,m=b.cloneDeep(this.markup);Array.isArray(m)||d("Expects Prototype JSON Markup.");for(var n=b.normalizeSides(f.padding),o=0,p=0;p<k;p++){for(var q=[],r=[],s=[],t=[],u=[],v=Array.from(j[p]),w=this.createQueue(v,0,[],null),x=0,y=0;w.length>0;){var z=w.pop(),A=z.path,B=z.level,C=z.item,D=z.parent;0===B&&A.splice(1,0,p);var E=C.id,F=B!==-1,G=C.height||g,H=C.icon,I=C.items,J=!!C.highlighted,K=!!C.collapsed,L=Array.isArray(I)&&I.length>0;E||d("Item id required."),e.hasOwnProperty(E)&&d("Duplicated item id.");var M=e[E]={path:A,visible:F,parent:D,label:C.label,height:G,group:p,hasSubItems:L,highlighted:J,collapsed:K};if(L&&(M.children=I.map(function(a){return a.id}),Array.prototype.push.apply(w,this.createQueue(I,K||!F?-1:B+1,A,E))),F){var N=h*B;if(M.x=N+h,M.y=x,M.cx=N+h/2,M.cy=x+G/2,M.span=C.span||1,E){var O=this.getItemBodyMarkup(C,N,x,p,i&&0===p?n.left:0);q.push(O);var P=this.getItemLabelMarkup(C,N,x,p);r.push(P),L&&(s.push(this.getButtonMarkup(C,N,x,p)),K||u.push(E)),H&&(t.push(this.getIconMarkup(C,N,x,p)),M.x+=f.itemIcon.width+f.itemIcon.padding)}y=Math.max(y,M.x+f.itemMinLabelWidth),x+=G}}o=Math.max(y,o),l=Math.max(l,x);var Q=[];m.push({tagName:"g",selector:this.getSelector("group",p),groupSelector:"groups",attributes:{"record-group":p},children:Q}),Q.push({tagName:"g",selector:this.getSelector("bodiesGroup",p),groupSelector:"bodiesGroups",children:q},{tagName:"g",selector:this.getSelector("labelsGroup",p),groupSelector:"labelsGroups",children:r}),u.length>0&&Q.push({tagName:"g",selector:this.getSelector("forksGroup",p),groupSelector:"forksGroups",children:u.map(this.getForkMarkup,this)}),s.length>0&&Q.push({tagName:"g",selector:this.getSelector("buttonsGroup",p),groupSelector:"buttonsGroups",children:s}),t.length>0&&Q.push({tagName:"g",selector:this.getSelector("iconsGroup",p),groupSelector:"iconsGroups",children:t})}c.padding=n,c.groupsCount=k,c.overflow=i,c.minHeight=l+n.top+n.bottom,c.minWidth=o*k+n.left+n.right;var R=b.assign({record:this.id},a);this.set("markup",m,R),this.autoresize(R)},autoresize:function(a){var b=this.getMinimalSize(),c=this.attributes.size.width;this.resize(Math.max(c,b.width),b.height,a)},getMinimalSize:function(){var a=this.metrics;return{width:a.minWidth,height:a.minHeight}},removeInvalidLinks:function(a){var b=this.graph;return b?b.getConnectedLinks(this).filter(this.isLinkInvalid,this).map(function(b){return b.remove(a)}):[]},isLinkInvalid:function(a){var b=this.id,c=this.metrics.items,d=a.source();if(d.id===b&&d.hasOwnProperty("port")&&!c[d.port])return!0;var e=a.target();return!(e.id!==b||!e.hasOwnProperty("port")||c[e.port])},createQueue:function(a,b,c,d){var e=a.length;return Array.from({length:e},function(f,g){var h=e-g-1;return{path:c.concat(["items",h]),item:a[h],level:b,parent:d}})},getGroupSelector:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=[a],d=0,e=b.length;d<e;d++){var f=b[d];if(null!==f&&void 0!==f){Array.isArray(f)||(f=[f]);for(var g=0,h=f.length;g<h;g++)c.push(this.getSelector(a,f[g]))}}return c},getItemLabelMarkup:function(a,b,c,d){var e=this.attributes,f=e.itemOffset,g=a.height||e.itemHeight,h=a.id,i=b+f;return a.icon&&(i+=e.itemIcon.width+2*e.itemIcon.padding),{tagName:"text",className:"record-item-label",selector:this.getSelector("itemLabel",h),groupSelector:this.getGroupSelector("itemLabels",d,a.group),attributes:{x:i,y:c+g/2,"item-id":h}}},getItemBodyMarkup:function(a,b,c,d,e){var f=a.height||this.attributes.itemHeight,g=0;e&&(g-=e);var h={x:g,y:c,height:f,"item-id":a.id},i=a.span;return i&&(h["item-span"]=i),{tagName:"rect",selector:this.getSelector("itemBody",a.id),groupSelector:this.getGroupSelector("itemBodies",d,a.group),className:"record-item-body",attributes:h}},getButtonMarkup:function(a,b,c){var d=this.attributes,e=d.itemButtonSize,f=d.itemOffset,g=a.height||d.itemHeight;return{tagName:"path",className:"record-item-button",attributes:{d:this.getButtonPathData(b+f/2,c+g/2,e/2,a.collapsed),"item-id":a.id,cursor:"pointer","shape-rendering":"geometricprecision"}}},getIconMarkup:function(a,b,c){var d=this.attributes,e=d.itemOffset,f=d.itemIcon,g=a.height||d.itemHeight;return{tagName:"image",className:"record-item-icon",attributes:{x:b+e+f.padding,y:c+(g-f.height)/2,width:f.width,height:f.height,"xlink:href":a.icon}}},getForkMarkup:function(a){return{tagName:"path",attributes:{d:this.getForkPathData(a),fill:"none"}}},getButtonPathData:function(a,b,c,d){var e=["M",a-c,b-c,a+c,b-c,a+c,b+c,a-c,b+c,"Z","M",a-c/2,b,a+c/2,b];return d&&Array.prototype.push.apply(e,["M",a,b-c/2,a,b+c/2]),e.join(" ")},getForkPathData:function(a){var b=this.metrics.items;if(!b)return null;var c=b[a];if(!c)return null;var d=c.children;if(!d||0===d.length)return null;for(var e,f=this.attributes.itemButtonSize,g=[],h=0,i=d.length;h<i;h++){e=b[d[h]];var j=e.cx+(e.hasSubItems?-1:1)*f/2;g.push("M",c.cx,e.cy,j,e.cy)}return g.push("M",c.cx,c.cy+f/2,c.cx,e.cy),g.join(" ")},item:function(a,b,c){var d=this.getItemPathArray(a);return d?void 0===b?this.prop(d):this.prop(d,b,c):null},toggleItemCollapse:function(a,b){var c=this.getItemPathArray(a);if(!c)return this;c.push("collapsed");var d=!!this.prop(c);return this.prop(c,!d,b),this},toggleItemHighlight:function(a,b){var c=this.getItemPathArray(a);if(!c)return this;c.push("highlighted");var d=!!this.prop(c);return this.prop(c,!d,b),this},isItemVisible:function(a){return this.getItemCacheAttribute(a,"visible")},isItemCollapsed:function(a){return this.getItemCacheAttribute(a,"collapsed")},isItemHighlighted:function(a){return this.getItemCacheAttribute(a,"highlighted")},getItemParentId:function(a){return this.getItemCacheAttribute(a,"parent")},getItemGroupIndex:function(a){return this.getItemCacheAttribute(a,"group")},getItemPathArray:function(a){var b=this.getItemCacheAttribute(a,"path");return b?b.slice():null},getItemSide:function(a){var b=this.getItemGroupIndex(a);if(null===b)return null;var c=this.metrics,d=c.groupsCount;if(d>1){if(0===b)return"left";if(b+c.items[a].span-1===d-1)return"right"}return"middle"},getItemCacheAttribute:function(a,b){if(!b)return null;var c=this.metrics.items;if(!c)return null;var d=c[a];return d?d[b]:null},getSelector:function(a,b){return a+"_"+b},removeItem:function(a,c){var d=this.getItemPathArray(a);if(!d)return this;var e=d.pop(),f=this.prop(d).slice();return f.length>1?(f.splice(e,1),this.prop(d,f,b.assign({rewrite:!0},c))):d.length>2?this.removeProp(d,c):(e=d.pop(),f=this.get("items").slice(),f.splice(e,1),this.prop(d,f,b.assign({rewrite:!0},c))),this},addNextSibling:function(a,b,c){var d=this.getItemPathArray(a);if(!d)return this;var e=this.getItemParentId(a)||this.getItemGroupIndex(a),f=d[d.length-1]+1;return this.addItemAtIndex(e,f,b,c)},addPrevSibling:function(a,b,c){var d=this.getItemPathArray(a);if(!d)return this;var e=this.getItemParentId(a)||this.getItemGroupIndex(a),f=d[d.length-1];return this.addItemAtIndex(e,f,b,c)},addItemAtIndex:function(a,c,e,f){if(!e)return this;var g;switch(typeof a){case"number":var h=this.prop("items"),i=Math.min(Math.max(a,0),h.length);g=["items",i];break;case"string":if(g=this.getItemPathArray(a),!g)return this;g.push("items");break;default:d("Requires an item id.")}var j=this.prop(g);j=Array.isArray(j)?j.slice():[];var k=Math.min(Math.max(c,0),j.length);return j.splice(k,0,e),this.prop(g,j,b.assign({rewrite:!0},f))},toJSON:function(){var b=a.dia.Element.prototype.toJSON.apply(this,arguments);return delete b.markup,b}},{attributes:{itemText:{set:function(a,d,e,f){if(!b.isPlainObject(a))return null;var g=this.model,h=e.getAttribute("item-id"),i=g.metrics.items[h];if(i){var j,k,l=i.label,m=g.metrics.padding,n=g.metrics.groupsCount,o=i.x,p=(d.width-m.left-m.right)/n*i.span-o,q=new c.Rect(o,i.y,p,i.height);a.textWrap?(j="textWrap",k={text:l,ellipsis:a.ellipsis}):(j="text",k=l),this.getAttributeDefinition(j).set.call(this,k,q,e,f)}}},itemHighlight:{set:function(a,c,d,e){if(!b.isPlainObject(a))return null;var f=this.model,g=d.getAttribute("item-id"),h=f.getItemCacheAttribute(g,"highlighted");switch(h){case!0:return a;case null:case!1:return Object.keys(a).reduce(function(a,c){var f=e.hasOwnProperty(c)||e.hasOwnProperty(b.camelCase(c));return!f&&d.getAttribute(c)&&(a[c]=null),a},{})}}},groupWidth:{set:function(a,b,c){var d=this.model.metrics,e=d.padding,f=d.groupsCount,g=(b.width-e.left-e.right)/f,h=c.getAttribute("item-span");if(h&&(g*=Number(h)),d.overflow){var i=Number(this.findAttribute("record-group",c));0===i&&(g+=e.left),i===f-1&&(g+=e.right)}return{width:g}}},groupPosition:{position:function(a,b,d){var e=Number(d.getAttribute("record-group")),f=this.model.metrics,g=f.groupsCount,h=f.padding,i=(b.width-h.left-h.right)/g,j=h.left+e*i,k=h.top;return new c.Point(j,k)}}}});g.define("standard.BorderedRecord",{padding:0,attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#000000",fill:"#FFFFFF"}}},{markup:[{tagName:"rect",selector:"body"}]}),g.define("standard.HeaderedRecord",{padding:{top:30,left:0,right:0,bottom:0},attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#000000",fill:"#FFFFFF"},header:{refWidth:"100%",height:30,stroke:"#000000",fill:"transparent"},headerLabel:{refX:"50%",refY:15,textAnchor:"middle",textVerticalAnchor:"middle",fontSize:20,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerLabel"}]});var h=a.dia.ElementView.extend({events:{"mousedown .record-item-button":"onItemButtonClick","touchstart .record-item-button":"onItemButtonClick"},init:function(){a.dia.ElementView.prototype.init.apply(this,arguments);var b=this.model;b instanceof g&&(this.stopListening(),this.listenTo(b,"change",this.onModelChange))},onModelChange:function(a){return a.hasChanged("ports")&&this._refreshPorts(),a.hasChanged("markup")?void this.render():(a.hasChanged("position")&&this.translate(),a.hasChanged("angle")&&this.rotate(),a.hasChanged("size")?void this.resize():void(a.anyHasChanged(a.markupAttributes.concat(["attrs","size"]))&&this.update()))},getLinkEnd:function(a){return{id:this.model.id,port:this.findAttribute("item-id",a)}},getMagnetFromLinkEnd:function(b){for(var c=b.port,d=this.model;c&&!d.isItemVisible(c);)c=d.getItemParentId(c);c||a.dia.ElementView.prototype.getMagnetFromLinkEnd.apply(this,arguments);var e=d.getSelector("itemBody",c);return this.findBySelector(e,this.el,this.selectors)[0]},onItemButtonClick:function(a){a.stopPropagation(),a.preventDefault();var b=a.currentTarget.getAttribute("item-id");this.model.toggleItemCollapse(b,{ui:!0})}});f.RecordView=h,f.BorderedRecordView=h,f.HeaderedRecordView=h}(joint,joint.util,g);